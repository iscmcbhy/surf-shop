<% layout("/layouts/post-show-layout.ejs"); -%>
<hr>
<h1>Title: <%= post.title %></h1>
<div>Description: <%= post.description %></div>
<div>Price: <%= post.price %></div>
<div>Average Rating: <%=floorRating %></div>
<div>Location: <%= post.location %></div>
<div>
    <% for(let i = 0; i< 5; i++) { %> 
        <% if(i < floorRating) { %> 
            <i class="fas fa-star fa-3x"></i>
        <% } else if ((post.avgRating - i) > 0 && (post.avgRating - i ) < 1) { %>
            <i class="fas fa-star-half-stroke fa-3x"></i>
        <% } else { %> 
            <i class="far fa-star fa-3x"></i>
        <% } %> 

    <% } %> 
</div>
<% post.images.forEach(images => { %>
    <div><img src="<%= images.url %>" alt="Surf Board Image" width="100px"></div>
<% }); %>
<div id='map-container'>

</div>
<div>
    <a href="/posts/<%= post.id %>/edit">
        <button>Edit</button>
    </a>
</div>
<div>
    <form action="/posts/<%= post.id %>?_method=DELETE" method="POST">
        <button type="submit">Delete</button>
    </form>
</div>
<hr>
<h3>Create a Review</h3>
<form action="/posts/<%= post.id %>/reviews" method="POST">
    <div>Body: <textarea name="review[body]"></textarea></div>
    <!-- <div>Rating: <input name="review[rating]" type="number" min="1" max="5" step="1" required /></div> -->
    <% include ../partials/star-rating.ejs %>
    <div><input type="submit" /></div>
</form>
<!-- Display All Reviews <p class="starability-result" data-rating=""> </p>  -->
<h2>Reviews</h2>
<div>
    <% if(post.reviews && post.reviews != 0)
        for(const review of post.reviews) { %>
    ---------------------------------------------
    <div>Body: <%= review.body %></div>
    <div>Rated: <%= review.rating %> stars
        
    </div>
    <div>Author: <%= review.author.username %></div>
        <% if(review.author.equals(currentUser._id)) { %>
        <div>
            <button class="toggle-edit-form">Edit</button>
            <form action="/posts/<%= post.id %>/reviews/<%= review._id %>?_method=PUT" method="POST" class="edit-review-form">
                -->
                <div>Body: <textarea name="review[body]"><%= review.body %></textarea></div>
                
                <% include ../partials/edit-form-starability.ejs %>
                <div><input type="submit" value="Update"/></div>
            </form>
        </div>
        <script>$('#toggle-edit-rate<%= review.rating %>').prop('checked', true);</script>
        <form action="/posts/<%= post.id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
            <button type="submit">Remove Review</button>
        </form>
        <% } %>
    <% } %> 
</div>
<hr>

<script>
    let post = <%- JSON.stringify(post) %>;
    let mapBoxToken = "<%= mapBoxToken %>";
</script>

<script src="/javascripts/post-show.js"></script>