<% layout("layouts/boilerplate.ejs"); -%>
<h1>Posts Index</h1>

<div class="container-fluid">
    <div class="row">
        
        <div class="col-4">
            <%- include ("../partials/search-filter") %> 
        </div>

        <div class="col-8">
            <div id="map"></div>
        </div>

    </div>
</div>

<%- include ("../partials/paginatePosts") %> 

<% posts.docs.forEach((post) => { %>
    <div>
        <h3>Title: <%= post.title %></h3>
        <div>Author: <%= post.author === null ? "" : post.author.username %></div>
        <div>Description: <%= post.description %></div>
        <div>Price: <%= post.price %></div>
        <div>Location: <%= post.location %></div>
        <div><a href="/posts/<%= post.id %>">View More</a></div>
    </div>
<% }); %>

<%- include ("../partials/paginatePosts") %> 

<script>
    mapboxgl.accessToken = "<%= mapBoxToken %>";
    let posts = { features: <%- JSON.stringify(posts.docs) %> };
</script>

<script src="/javascripts/allPostsClusterMap.js">
    
</script>